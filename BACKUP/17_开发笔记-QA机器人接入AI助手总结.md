# [开发笔记-QA机器人接入AI助手总结](https://github.com/humyna/gitblog/issues/17)

# 一、背景
QA机器人是一个支持销售的问答机器人，包含产品、业务相关内容。
问答中包含图片、ppt、word、excel相关文件的相对路径地址。

由于QA机器人没有人维护了，产品希望将其服务下线，将相关问答内容整合到AI助手中。

# 二、方案
构建知识库，清洗QA机器人问答数据，然后导入知识库中(向量数据库)

**难点在于如何清洗数据。**

# 三、步骤
## 1.数据清洗
### 数据导出
所有问答数据到excel表格中，保留问题和答案两列

### 数据分析
问答中包含纯文本、包含html元素、包含链接等三种类型的文本数据。
需要分别处理。

### 数据处理
#### 纯文本

- 筛选过期问题；
- 筛选问答太长的问题，知识库的segment有限制）

#### 包含html元素

- 筛选过期问题
- 筛选问答太长的问题
- 调试验证ai助手客户端对于包含html元素的展示情况，以评估处理方案（完美支持，无法处理）

#### 包含链接

- 筛选过期问题
- 筛选问答太长的问题
- 文本中链接是相对路径，无法查看，且对应的存储服务需要下线，需要迁移文件到新存储上，并返回完整链接替换掉原链接，确保ai注释可以范围

## 2.文件迁移遇到的问题以及解决方案
A.原系统查看文档需要token,需要登录到后台拿到token，拼接下载链接

B.文件需要下载到本地，方便验证下载的文档的质量，可以通过下载的文件大小等去排除有问题的文档

C.不同类型的问题的处理方式不同
a.图片通过流直接下载；
b.pdf原系统是在浏览器阅读器打开的，无法下载；通过浏览器开发者工具找到真正的下载链接(需要代码中专门处理转换)
c.word\ppt的数据处理原系统也和pdf类似，但是打不开，存在bug。最终尝试和图片处理方式一样解决了
d.链接中存在微信公众号、邮箱等数据，需要过滤

D.文件上传到S3的API生成的链接有过期时间，默认30分钟，一开始没有设置，很快就过期了，最后设置成了30年

E.S3没有开通公网访问权限，只能部署到线上处理。包装了迁移代码，对外暴露了接口。

F.线上迁移程序无法通过域名访问待下载的链接的文档，最后尝试发现能ping通ip，通过ip的方式能访问成功。

## 3.接入AI助手
A.将问答分成文本和带链接的两种分别导入知识库；
B.ai助手配置链接，调试不同类型文档的展示情况
